# dsl 语法规范

## 语法概览

```text
声明语句:
    游戏声明:
        game 游戏名称 {}

    角色枚举声明:
        enum {}

    动作声明:
        action 动作名(参数列表) {}

    阶段声明:
        phase 阶段名称 {}

    步骤声明:
        step "步骤名称" for 角色列表 with 动作名 if (条件表达式) {}

    方法声明:
        def 方法名(参数列表) {}

    初始化声明:
        setup {}

    变量声明:
        num(变量名) = 值;
        str(变量名) = 值;
        bool(变量名) = 值;
        obj(变量名) = 值;

控制语句:
    分支语句:
        if(条件表达式) {}
        elif(条件表达式) {}
        else {}    
    循环语句:
        for(迭代变量, 表达式) {}
    流程语句:
        // 暂未实现break/continue，预留扩展

输入输出语句:
    // 暂不支持显式输入输出，仅通过解释器输出执行日志
```
## 基本概念

### 注释
`//`后的部分称做注释.会被解释器忽略。

### 字面量, 标识符和操作符

1.字面量
直接表示值的量,支持以下类型:数值型：1、3.14、-5（整型 / 浮点型）
                                字符串型："狼人刀人"、"白天阶段"、""（双引号包裹）
                                布尔型：true、false（小写固定写法）

2.标识符
用来承载字面量的符号，命名规则：以字母（中英文）、下划线开头
                             区分大小写（如 GameDay 和 gameday 是不同标识符）
                             不能使用保留关键字（game、enum、action、phase、step、def、
                             setup、num、str、bool、obj、if、for 等）

3.操作符
用来连接字面量和标识符的符号，支持以下类型：
算术操作符：
    + (加法)
    - (减法)
    * (乘法)
    / (除法)
    % (取模)
比较操作符：
    == (等于)
    != (不等于)
    < (小于)
    > (大于)
    <= (小于等于)
    >= (大于等于)
逻辑操作符：
    && (逻辑与)
    || (逻辑或)
    ! (逻辑非)
赋值操作符：
    = (赋值)
一元操作符：
    ! (逻辑非)

4.表达式
由字面量、标识符和操作符构成，分为两类：
                计算表达式示例：1+2、"狼"+"人"、游戏天数 > 1 && 女巫解药已用 == false
                赋值表达式示例：游戏天数 = 1、狼人.存活状态 = false、总存活数 = 好人阵营 + 狼人阵营

5.语句
在{}内的表达式称为语句，单个语句可通过;结尾（可选，解析器兼容有无分号的场景）

6.语句块
语句块由大括号{}包围的语句和{}的前置声明构成，支持嵌套多个语句块。

例如：
phase 夜晚 {
    step "狼人刀人" for 狼人 with kill if (游戏天数 > 0) {
        kill(预言家); // 内层语句块
    };
}

7.变量
变量规则:
    变量名必须以字母（中英文）或下划线开头，后面可跟字母、数字、下划线
    变量名区分大小写
    变量名不能使用 WolfDSL 保留关键字

变量的类型:
WolfDSL 支持 4 种数据类型：Num、Str、Bool 和 Obj：
    Num：包含整型和浮点型数值，默认值 0
    Str：包含单个字符和字符串，默认值 ""
    Bool：用于布尔运算，默认值 false
    Obj：用于复合类型数据（如阵营属性），默认值 {}
例如：
// 仅声明（使用默认值）
num(游戏天数);
str(当前阶段);
bool(女巫解药已用);
obj(狼人阵营);

// 声明并赋值
num(游戏天数) = 1;
str(当前阶段) = "夜晚";
bool(女巫解药已用) = false;
obj(狼人阵营) = {存活数: 3};

作用域：
变量的作用域分为全局作用域和局部作用域：
    全局作用域：在game {}顶级声明的变量，在整个脚本中可见
    局部作用域：在语句块（如step {}、if {}、for {}）内声明的变量，仅在当前块及子块中可见

8.核心声明
游戏声明：
    游戏声明是 WolfDSL 脚本的根节点，所有其他声明必须嵌套在game {}内：
wolfgame 标准狼人杀 {
    // 所有其他声明（enum/action/phase等）都在此处定义
}
角色枚举声明
用于定义游戏中的角色列表，角色名以标识符形式声明，多个角色用,分隔：
wolf
enum {
    狼人, 预言家, 平民, 猎人, 女巫
};
动作声明
用于定义游戏中的可执行动作，支持参数列表和执行逻辑块：
wolf
// 无参数动作
action 游戏结束() {
    游戏状态 = "结束";
};

// 带参数动作
action kill(目标角色) {
    目标角色.存活状态 = false;
    对应阵营.存活数 = 对应阵营.存活数 - 1;
};
阶段声明
用于定义游戏的阶段（如夜晚、白天），内部可嵌套 step、变量、条件 / 循环语句：
wolf
phase 夜晚 {
    // 阶段内的步骤、变量、逻辑等
    step "狼人刀人" for 狼人 with kill if (游戏天数 > 0) {
        kill(预言家);
    };
}
步骤声明
步骤是阶段的最小执行单元，关联角色、动作和执行条件：
wolf
// 完整格式
step "步骤名称" for 角色列表 with 动作名 if (条件表达式) {
    // 步骤执行逻辑
};

// 简化格式（无动作/条件）
step "玩家发言" for 平民,猎人 {
    当前阶段 = "白天发言";
};
参数说明：
"步骤名称"：字符串类型，步骤的显示名称
for 角色列表：多个角色用,分隔，指定执行该步骤的角色
with 动作名：关联已声明的动作，执行步骤时会触发该动作
if (条件表达式)：可选，满足条件时才执行步骤
方法声明
用于定义可复用的逻辑块，支持参数列表：
wolf
def 计算存活数(阵营) {
    阵营.存活数 = 阵营.总人数 - 阵营.死亡数;
}
初始化声明
用于定义游戏的初始化逻辑，脚本执行时优先执行setup {}内的语句：
wolf
setup {
    游戏天数 = 1;
    女巫解药已用 = false;
    狼人阵营.存活数 = 3;
}
控制流语句
条件语句
支持 if/elif/else 分支，条件表达式返回布尔值：
wolf
if(狼人阵营.存活数 == 0) {
    获胜阵营 = "好人";
    游戏结束 = true;
} elif(好人阵营.存活数 == 0) {
    获胜阵营 = "狼人";
    游戏结束 = true;
} else {
    游戏继续 = true;
}
循环语句
支持 for 循环，格式为for(迭代变量, 表达式)，迭代变量为自定义标识符：
wolf
// 累加1-5的数值
num(总伤害) {
    num(总和) = 0;
    for(i, 1, 5) {
        总和 = 总和 + i * 10;
    }
    总和;
}
