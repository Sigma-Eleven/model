# LuduScript 语法规范

## 语法概览

```text
声明语句:
    对象声明:
        obj("className", idExpr) {}

    变量声明:
        num(varName) {}
        str(varName) {}
        bool(varName) {}

控制语句:
    分支语句:
        if(condExpr) {}
        elif(condExpr) {}
        else {}    
    循环语句:
        for(iterVarName, countExpr) {}
        for(iterVarName, start, end) {}
        for(iterVarName, start, end, step) {}
    流程语句:
        continue {}
        break {}   

输入输出语句:
    // 暂不支持
```

## 基本概念

### 注释

`//`后的部分称做注释.会被解释器忽略。

> 注:LuduScript没有加入多行注释的计划

### 字面量, 标识符和操作符

1. 字面量

    直接表示值的量. 如`1.2`,`10`,`true`,`false`,`"HelloWorld"`等

2. 标识符

    用来承载字面量的符号. 如 `a`,`_bc`等

    > 注:可以用标识符承载标设符.

3. 操作符

    用来连接字面量和标识错的符号. 如`+`,`-`,`*`,`/`,`%`,`==`,`!=`,`<`,`<=`,`>`,`>=`等

    **算术操作符**

    - `+` (加法)
    - `-` (减法)
    - `*` (乘法)
    - `/` (除法)
    - `%` (取模)

    **比较操作符**

    - `==` (等于)
    - `!=` (不等于)
    - `<` (小于)
    - `>` (大于)
    - `<=` (小于等于)
    - `>=` (大于等于)

    **逻辑操作符**

    - `&&` (逻辑与)
    - `||` (逻辑或)
    - `!` (逻辑非)

    **一元操作符**

    - `-` (负号)
    - `!` (逻辑非)

### 表达式

由字面量, 标识符和操作符构成

1. 计算表达式
    如`1+2`,`"a"+"b"`,`true&false`等

2. 赋值表达式
    如`a=1`,`b="a"`,`c=true`等

    > 注:单独的标识符也是表达式,但是字面量和操作符不能单独作为表达式.

### 语句

在`{}`内的表达式可以称为语句。

### 语句块

语句块由大括号`{}`包围的语句和`{}`的前置构成. 你可以将表达式填充语句块, 也可以嵌套多个语句块.

## 变量

### 变量规则

- 变量名必须以字母或下划线开头，后面可以跟字母、数字或下划线
- 变量名区分大小写
- 变量名不能使用保留关键字

### 变量的类型

在 LuduScript 中支持3种数据类型：Num、Str 和 Bool。

- Num 包含整型和浮点型
- Str 包含单个字符和字符串
- Bool 用于布尔运算

### 变量的声明

```lud
num(number) {}
str(string) {}
bool(boolean) {}
```

声明的变量会拥有默认值：`0`、`""`、`false`.

### 变量的赋值

使用 `=` 赋值运算符. 可以先声明，再赋值，也可以声明的同时赋值.

在{}内也可以书写复杂的语句块，支持以下语法：

**简单赋值**：

```lud
num(变量名) {
    // 语句块
    num(i) { 10 }
    num(j) { 20 }
    i + j  // 最后一个表达式的值会作为变量的值
    i * j  // 支持多个表达式, 但只有最后一个表达式的值会被返回
}
```

**支持条件语句**：

```lud
num(hp) {
    num(base_hp) { 100 }
    if(level > 10) {
        num(bonus) { 50 }
    } else {
        num(bonus) { 20 }
    }
    num(total) { base_hp + bonus }
    total  // 返回计算结果
}
```

**支持循环语句**：

```lud
num(total_damage) {
    num(sum) { 0 }
    for(i, 1, 5) {
        num(sum) { sum + i * 10 }
    }
    sum  // 返回累计结果
}
```

### 作用域

变量的作用域分为全局作用域和局部作用域。

- 全局作用域：当变量在所有`obj() {}`语句块外部声明时, 在整个脚本文件中都可见
- 局部作用域：当变量在语句块内部声明时, 变量在所在同级和所有子级语句块中可见

## 对象

```lud
obj("类名", ID表达式) {
    // 对象属性定义
    num(属性名) { 值 }
    str(属性名) { 值 }
    bool(属性名) { 值 }
}
```

### 对象字段相互引用

对象内部的字段(即声明的变量)可以相互引用，支持复杂的计算逻辑：

```lud
num(bonus_per_level) { 2 }

obj("Equipment", 1001) {
    num(base_attack) { 10 }
    num(enhance_level) { 3 }
    
    // 字段可以引用同一对象内的其他字段
    num(bonus_attack) {
        bonus_per_level * enhance_level 
    }
    
    // 计算最终攻击力
    num(final_attack) {
        base_attack + bonus_attack
    }
}
```

**字段引用规则**：

- 字段必须在引用前已经声明
- 支持在初始化块内引用同一对象的其他已声明字段
- 字段引用遵循声明顺序，不能前向引用

**基本属性**：

- 对象会自动添加 `class` 和 `id` 字段
- 所有创建的对象会输出到JSON数组中

## 控制流语句

### 条件语句

```lud
if(条件表达式) {
    // 语句块
}
elif(条件表达式) {
    // 语句块  
}
else {
    // 语句块
}
```

### 循环语句

```lud
for(迭代变量, 总数) {           // 从1到总数
    // 语句块
}

for(迭代变量, 起始值, 结束值) { // 从起始值到结束值
    // 语句块
}

for(迭代变量, 起始值, 结束值, 步长) {
    // 语句块
}
```

> luduScript 将不会支持无限循环 (即不会加入 while(){} 语句块)

### 流程语句

```lud
// 跳出语句块
break {
    // 跳出时执行的语句
}

// 跳转至语句块结尾
continue {
    // 跳转时执行的语句
}
```

## 语法特点

1. **面向对象生成**：主要用于生成JSON格式的对象数据
2. **类型安全**：支持三种基本数据类型的声明
3. **作用域管理**：支持块级作用域和变量栈
4. **表达式优先级**：按标准数学运算优先级处理
5. **灵活的for循环**：支持1-3个参数的不同循环模式
6. **复杂初始化块**：支持在变量初始化块内使用条件语句、循环语句等复杂逻辑
7. **对象字段引用**：对象内部字段可以相互引用，支持复杂的计算和依赖关系
8. **智能作用域处理**：初始化块内的变量作用域与对象字段作用域分离，避免命名冲突

## 输出格式

解释器执行后会生成JSON数组，包含所有创建的对象，每个对象都有：

- `class`: 对象类名
- `id`: 对象ID
- 其他用户定义的属性

这个语言特别适合用于游戏开发中的卡牌、道具、角色等游戏对象的批量生成和配置。
